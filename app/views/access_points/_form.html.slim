.row
  = form_for(@access_point, html: {class: "form-horizontal form-bordered"}) do |f|
    .col-sm-6
      .form-group
        = f.label :zone, class: "col-sm-2 control-label", style: "text-align: left"
        .col-sm-8
          = f.select :zone_id,options_from_collection_for_select(Zone.all, "id", "name"), { class: 'form-control'}
      .form-group
        = f.label :ssid, class: "col-sm-2 control-label", style: "text-align: left"
        .col-sm-8
          = f.text_field :ssid, class: "form-control"
      .form-group
        = f.label :ip_address, class: "col-sm-2 control-label", style: "text-align: left"
        .col-sm-8
          = f.text_field :ip_address, class: "form-control"
      .form-group
        = f.label :mac_address, class: "col-sm-2 control-label", style: "text-align: left"
        .col-sm-8
          = f.text_field :mac_address, class: "form-control"
      .form-group
        = f.label :user, class: "col-sm-2 control-label", style: "text-align: left"
        .col-sm-8
          = f.text_field :user, class: "form-control"
      .form-group
        = f.label :password, class: "col-sm-2 control-label", style: "text-align: left"
        .col-sm-8
          = f.password_field :password, class: "form-control"
      .input-group.mb-15
        .col-sm-2
          | Jitter
        .col-sm-8
          = number_field_tag :min_jitter,nil, class: 'form-control no-border-right', style: 'width: 40%', placeholder: 'min'
          = number_field_tag :max_jitter,nil, class: 'form-control no-border-left', style: 'width: 40%', placeholder: 'max'
      .input-group.mb-15
        .col-sm-2
          | Ping
        .col-sm-8
          = number_field_tag :min_ping,nil, class: 'form-control no-border-right', style: 'width: 40%', placeholder: 'min'
          = number_field_tag :max_ping,nil, class: 'form-control no-border-left', style: 'width: 40%', placeholder: 'max'
      .input-group.mb-15
        .col-sm-2
          | Latencia
        .col-sm-8
          = number_field_tag :min_latency,nil, class: 'form-control no-border-right', style: 'width: 40%', placeholder: 'min'
          = number_field_tag :max_latency,nil, class: 'form-control no-border-left', style: 'width: 40%', placeholder: 'max'
      .input-group.mb-15
        .col-sm-2
          | Velocidad de enlace
        .col-sm-8
          = number_field_tag :min_link_speed,nil, class: 'form-control no-border-right', style: 'width: 40%', placeholder: 'min'
          = number_field_tag :max_link_speed,nil, class: 'form-control no-border-left', style: 'width: 40%', placeholder: 'max'
      .input-group.mb-15
        .col-sm-2
          | Nivel de senal
        .col-sm-8
          = number_field_tag :min_sign_level,nil, class: 'form-control no-border-right', style: 'width: 40%', placeholder: 'min'
          = number_field_tag :max_sign_level,nil, class: 'form-control no-border-left', style: 'width: 40%', placeholder: 'max'

      .form-group
        .pull-right
          = link_to "Cancelar", :back ,class: "btn btn-danger mr-5"
          = f.submit "Guardar", class: "btn btn-success mr-5"

    .col-sm-6
      = f.fields_for :coordinate do |ff|
        = ff.hidden_field :latitude, required: true
        = ff.hidden_field :longitude, required: true
      #router style=("width: 100%; height: 300px;")
javascript:
  var limits = []
  var points = []
  var point = []
  $('#access_point_zone_id').change(function(){
    map.removePolygons();
    get_zone(this)
  });

  function get_zone(zone){
    $.ajax({
      type: "GET",
      url:  "#{api_data_zone_path}",
      data: {
        id: zone.options[zone.selectedIndex].value
      },
      success: function(data, textStatus, jqXHR){
        drawArea(data);
      },
      error: function(jqXHR, textStatus, errorThrown){
        console.log("no guardo");
      }
    });
  }

  function drawArea(set_points){
    points = set_points
    limits = map.drawPolygon({
      paths: set_points
    })
  }

  function polygonCenter() {
    var lowx,
        highx,
        lowy,
        highy,
        lats = [],
        lngs = []

    for(var i=0; i<limits.length; i++) {
      lats.push(limits[i][0]);
      lngs.push(limits[i][1]);
    }

    lats.sort();
    lngs.sort();
    lowx = lats[0];
    highx = lats[points.length - 1];
    lowy = lngs[0];
    highy = lngs[points.length - 1];
    center_x = lowx + ((highx-lowx) / 2);
    center_y = lowy + ((highy - lowy) / 2);
    return (new google.maps.LatLng(center_x, center_y));
  }

  var map = new GMaps({
    el: '#router',
    lat:  #{Setting.center[0]},
    lng:  #{Setting.center[1]},
  });

  $(document).ready(function(){
    drawArea(#{ @access_point.zone.present? ? @access_point.zone.coordinates.map  { |z| [z.latitude, z.longitude] } : Zone.first.coordinates.map  { |z| [z.latitude, z.longitude] } })

    point = map.addMarker({
      lat:  #{Setting.center[0]},
      lng:  #{Setting.center[1]},
      icon: "#{ asset_path('router-logo.png') }",
      draggable: true,
      fences: [limits],
      outside: function(){
        alert('El punto esta fuera del marco')
      }
    });

    point.addListener('drag',function(event){
      $('#access_point_coordinate_attributes_latitude').val(event.latLng.lat())
      $('#access_point_coordinate_attributes_longitude').val(event.latLng.lng())
    });
  })
